<%- include('head', { active: 'product' }) -%>

<style>
    .event-title {
        font-size: 1.25rem;
        font-weight: bold;
        margin-top: 1rem;
    }
    
    .event-grid img {
        width: 100%;
        height: auto;
    }

    .carousel-item img {
        width: 100%;
        height: 300px;
        object-fit: cover;
    }

    .carousel-indicators {
        position: relative; /* Change to relative to place them below the carousel */
        bottom: -20px; /* Adjust spacing below the carousel */
        margin-top: 10px; /* Optional: Add space between the carousel and indicators */
        display: flex;
        justify-content: center;
    }

    .view-detail-btn {
        width: 108px;
        height: 36px;
        border: 1px #000 solid;
        border-right: 2px #000 solid;
        border-bottom: 2px #000 solid;
        background-color: #FFF;
        color: #000;
        position: absolute;
        bottom: 16px; /* Adjust for padding */
        left: 32px; /* Adjust for alignment */
        z-index: 10;
        padding: 4px 8px; /* Adjust for spacing */
        cursor: pointer;
        font-size: 14px; /* Font size for readability */
        transition: 0.2s ease-in;
    }

    .view-detail-btn:hover {
        background-color: #000; /* Dark background on hover */
        color: #FFF; /* White text on hover */
        transition: 0.2s ease-in-out;
    }
</style>

<!-- Page Header Start -->
<div class="container-fluid page-header mb-5 wow fadeIn" data-wow-delay="0.1s">
    <div class="container">
        <h1 class="display-3 mb-3 animated slideInDown">Events</h1>
        <nav aria-label="breadcrumb animated slideInDown">
            <ol class="breadcrumb mb-0">
                <li class="breadcrumb-item">
                    <a class="text-body" href="/">Home</a>
                </li>
                <li class="breadcrumb-item text-light active" aria-current="page">
                    Events
                </li>
            </ol>
        </nav>
    </div>
</div>
<!-- Page Header End -->

<!-- Product Start -->
<div class="container-xxl py-5">
    <div class="container">

        <div class="container my-3">
            <!-- Carousel -->
            <div id="multiImageCarousel" class="carousel slide" data-bs-ride="carousel">
                <!-- Carousel items -->
                <div class="carousel-inner notable-events" data-notable-events="<%- encodeURIComponent(JSON.stringify(notableEvents)) %>">
                    <!-- Dynamic slides will be inserted here -->
                </div>
                <!-- Navigation buttons -->
                <button class="carousel-control-prev" type="button" data-bs-target="#multiImageCarousel" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#multiImageCarousel" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                </button>
                <!-- Indicators -->
                <div class="carousel-indicators">
                    <!-- Dynamic dots will be inserted here -->
                </div>
            </div>
        </div>

            <div class="special-event-wrapper">
                <h2 class="special-event-heading">Special event</h2>
                <div class="special-events container">
                    <div class="row justify-content-center">
                        <% specialEvents.forEach((event) => { %>
                            <div class="col-2">
                                <a href="/detail/<%=event._id%>"><img src="<%= event.imgURL%>" alt="Banner" height="120px" width="200px"></a>
                                <div><%= event.title%></div>
                            </div>
                        <% }); %>
                    </div>
                </div>
            </div>

            <div class="events-near-you-wrapper">
                <h2 class="events-near-you-heading">Events near you</h2>
                <div class="events-near-you container">
                    <div class="row justify-content-center">
                        <% eventsNearYou.forEach((event) => { %>
                            <div class="col-2">
                                <a href="/detail/<%=event._id%>">
                                    <img src="<%= event.imgURL%>" alt="something" height="120px" width="200px">
                                </a>
                                <div><%= event.title%></div>
                            </div>
                        <% }); %>
                    </div>
                </div>
            </div>
        </div>

        <div class="row g-0 gx-5 align-items-end">
            <div class="col-lg-6">
                <div class="section-header text-start mb-5 wow fadeInUp" data-wow-delay="0.1s" style="max-width: 500px">
                    <h1 class="display-5 mb-3">Events</h1>
                    <p>
                        Explore our amazing collection of events, from exhilarating music concerts to unique
                        artistic performances.
                    </p>
                </div>
            </div>

            <div class="col-lg-6 text-start text-lg-end wow slideInRight" data-wow-delay="0.1s">
                <ul class="nav nav-pills d-inline-flex justify-content-end mb-5">
                    <li class="nav-item me-2">
                        <a class="btn btn-outline-primary border-2 active" data-bs-toggle="pill" href="#tab-1">Music</a>
                    </li>
                    <li class="nav-item me-2">
                        <a class="btn btn-outline-primary border-2" data-bs-toggle="pill" href="#tab-2">Performance & Arts
                        </a>
                    </li>
                    <li class="nav-item me-0">
                        <a class="btn btn-outline-primary border-2" data-bs-toggle="pill" href="#tab-3">Other</a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="tab-content">
            <div id="tab-1" class="tab-pane fade show p-0 active">
                <div class="row g-4">
                    <% musicEvents.forEach((musicEvent) => { %>
                        <div class="col-xl-3 col-lg-4 col-md-6 wow fadeInUp" data-wow-delay="0.1s">
                            <div class="product-item">
                                <div class="position-relative bg-light overflow-hidden">
                                    <img class="img-fluid w-100 fixed-size" src="<%= musicEvent.imgURL%>" alt="" />
                                    <div class="bg-secondary rounded text-white position-absolute start-0 top-0 m-4 py-1 px-3">
                                        New
                                    </div>
                                </div>
                                <div class="text-center p-4">
                                    <a class="d-block h5 mb-2 text-truncate" href="/detail/<%=musicEvent._id%>"><%= musicEvent.title %></a>
                                    <p class="text-clamp">
                                        <%= musicEvent.description %>
                                    </p>
                                </div>
                                <div class="d-flex border-top">
                                    <small class="w-50 text-center border-end py-2">
                                        <a class="text-body" href="/detail/<%=musicEvent._id%>"><i class="fa fa-eye text-primary me-2"></i>View
                                            detail</a>
                                    </small>
                                    <small class="w-50 text-center py-2">
                                        <a class="text-body" href="/detail/<%=musicEvent._id%>/booking"><i class="fa fa-shopping-bag text-primary me-2"></i>Add
                                            to cart</a>
                                    </small>
                                </div>
                            </div>
                        </div>
                    <% }); %>
                </div>
            </div>
            <div id="tab-2" class="tab-pane fade show p-0">
                <div class="row g-4">
                    <% performanceOrArtEvents.forEach((performanceOrArtEvent) => { %>
                        <div class="col-xl-3 col-lg-4 col-md-6 wow fadeInUp" data-wow-delay="0.1s">
                            <div class="product-item">
                                <div class="position-relative bg-light overflow-hidden">
                                    <img class="img-fluid w-100 fixed-size" src="<%= performanceOrArtEvent.imgURL%>" alt="" />
                                    <div class="bg-secondary rounded text-white position-absolute start-0 top-0 m-4 py-1 px-3">
                                        New
                                    </div>
                                </div>
                                <div class="text-center p-4">
                                    <a class="d-block h5 mb-2 text-truncate" href="/detail/<%=performanceOrArtEvent._id%>"><%= performanceOrArtEvent.title %></a>
                                    <p class="text-clamp">
                                        <%= performanceOrArtEvent.description %>
                                    </p>
                                </div>
                                <div class="d-flex border-top">
                                    <small class="w-50 text-center border-end py-2">
                                        <a class="text-body" href="/detail/<%=performanceOrArtEvent._id%>"><i class="fa fa-eye text-primary me-2"></i>View
                                            detail</a>
                                    </small>
                                    <small class="w-50 text-center py-2">
                                        <a class="text-body" href="/detail/<%=performanceOrArtEvent._id%>/booking"><i class="fa fa-shopping-bag text-primary me-2"></i>Add
                                            to cart</a>
                                    </small>
                                </div>
                            </div>
                        </div>
                    <% }); %>
                </div>
            </div>
            <div id="tab-3" class="tab-pane fade show p-0">
                <div class="row g-4">
                    <% otherEvents.forEach((otherEvent) => { %>
                        <div class="col-xl-3 col-lg-4 col-md-6 wow fadeInUp" data-wow-delay="0.1s">
                            <div class="product-item">
                                <div class="position-relative bg-light overflow-hidden">
                                    <img class="img-fluid w-100 fixed-size" src="<%= otherEvent.imgURL%>" alt="" />
                                    <div class="bg-secondary rounded text-white position-absolute start-0 top-0 m-4 py-1 px-3">
                                        New
                                    </div>
                                </div>
                                <div class="text-center p-4">
                                    <a class="d-block h5 mb-2 text-truncate" href="/detail/<%=otherEvent._id%>"><%= otherEvent.title %></a>
                                    <p class="text-clamp">
                                        <%= otherEvent.description %>
                                    </p>
                                </div>
                                <div class="d-flex border-top">
                                    <small class="w-50 text-center border-end py-2">
                                        <a class="text-body" href="/detail/<%=otherEvent._id%>"><i class="fa fa-eye text-primary me-2"></i>View
                                            detail</a>
                                    </small>
                                    <small class="w-50 text-center py-2">
                                        <a class="text-body" href="/detail/<%=otherEvent._id%>/booking"><i class="fa fa-shopping-bag text-primary me-2"></i>Add
                                            to cart</a>
                                    </small>
                                </div>
                            </div>
                        </div>
                    <% }); %>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Product End -->

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>

<script>
    const notableEventsElement = document.querySelector('.notable-events');
    const rawNotableEvents = decodeURIComponent(notableEventsElement.dataset.notableEvents);
    const notableEvents = JSON.parse(rawNotableEvents);

    const imagesPerSlide = 2; // Số lượng event mỗi trang

    const totalSlides = Math.ceil(notableEvents.length / imagesPerSlide);

    // Chọn các thành phần của carousel
    const carouselIndicators = document.querySelector('#multiImageCarousel .carousel-indicators');
    const carouselInner = document.querySelector('#multiImageCarousel .carousel-inner');

    for (let i = 0; i < totalSlides; i++) {
        // Tạo indicator
        const indicator = document.createElement('button');
        indicator.type = 'button';
        indicator.dataset.bsTarget = '#multiImageCarousel';
        indicator.dataset.bsSlideTo = i;
        indicator.className = i === 0 ? 'active' : '';
        indicator.ariaCurrent = i === 0 ? 'true' : '';
        indicator.ariaLabel = `Slide ${i + 1}`;
        carouselIndicators.appendChild(indicator);

        // tạo carousel
        const carouselItem = document.createElement('div');
        carouselItem.className = `carousel-item ${i === 0 ? 'active' : ''}`;
        carouselItem.style.position = 'relative';

        const startIdx = i * imagesPerSlide;
        const endIdx = startIdx + imagesPerSlide;
        const slideImages = notableEvents.slice(startIdx, endIdx);

        slideImages.forEach(image => {
            const imgWrapper = document.createElement('div');
            imgWrapper.className = 'col-md-6 d-inline-block px-4'; // Ensures images are side by side
            imgWrapper.style.position = 'relative';

            const imgElement = document.createElement('img');
            // test src chờ cập nhật db
            imgElement.src = "https://salt.tkbcdn.com/ts/ds/a2/2a/bc/29d53bc3ec2332fc8b659219fb42cd02.png";
            imgElement.alt = `Image ${image._id}`;
            imgElement.className = 'w-100';

            const aViewDetailBtn = document.createElement('a');
            const viewDetailBtn = document.createElement('button');
            viewDetailBtn.textContent = 'View Detail';
            viewDetailBtn.classList.add('view-detail-btn');
            aViewDetailBtn.appendChild(viewDetailBtn);
            aViewDetailBtn.href = `/detail/${image._id}`;

            imgWrapper.appendChild(imgElement);
            imgWrapper.appendChild(aViewDetailBtn);
            carouselItem.appendChild(imgWrapper);
        });

        carouselInner.appendChild(carouselItem);
    }
</script>

<%- include('foot')-%>
